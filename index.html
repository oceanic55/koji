<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Miso - Koji Calc</title>
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --muted: #9ca3af;
      --accent: #22d3ee;
      --text: #e5e7eb;
    }

    * {
      box-sizing: border-box
    }

    body {
      font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #0b1020, #111b2e);
      color: var(--text);
      margin: 0;
      padding: 32px
    }

    .card {
      max-width: 720px;
      margin: 0 auto;
      background: rgba(17, 24, 39, .75);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255, 255, 255, .06);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .35)
    }

    .header {
      padding: 22px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, .08)
    }

    h1 {
      margin: 0;
      font-weight: 800;
      letter-spacing: .3px;
      font-size: clamp(22px, 3.5vw, 30px)
    }

    .sub {
      margin-top: 6px;
      color: var(--muted);
      font-size: 14px
    }

    .body {
      padding: 22px 24px;
      display: grid;
      gap: 20px
    }

    label {
      display: block;
      font-size: 14px;
      color: #cbd5e1;
      margin-bottom: 8px
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 14px 12px;
      background: #0b1220;
      border: 1px solid rgba(255, 255, 255, .12);
      border-radius: 12px;
      color: var(--text);
      font-size: 16px;
      outline: none
    }

    input[type="number"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(34, 211, 238, .15)
    }

    .row {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr))
    }

    .result {
      display: grid;
      gap: 10px;
      background: linear-gradient(180deg, rgba(34, 211, 238, .1), rgba(34, 211, 238, .05));
      border: 1px solid rgba(34, 211, 238, .35);
      padding: 16px;
      border-radius: 14px
    }

    .result h2 {
      margin: 0;
      font-size: 18px
    }

    .big {
      font-size: 28px;
      font-weight: 800
    }

    .muted {
      color: var(--muted)
    }

    .formula {
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      background: #0b1220;
      border: 1px solid rgba(255, 255, 255, .12);
      padding: 12px;
      border-radius: 10px
    }

    .foot {
      padding: 16px 24px;
      border-top: 1px solid rgba(255, 255, 255, .08);
      color: #a1a1aa;
      font-size: 12px
    }

    .note {
      font-size: 13px;
      color: #c7d2fe
    }

    a.btn {
      display: inline-block;
      margin-top: 8px;
      color: #111827;
      background: var(--accent);
      text-decoration: none;
      font-weight: 700;
      padding: 10px 14px;
      border-radius: 12px
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="header">
      <h1>Miso Salt Calculator (Metric)</h1>
      <div class="sub">Calculate salt requirements based on protein and koji ingredients with customizable salt
        percentage.</div>
    </div>
    <div class="body">
      <div class="row">
        <div>
          <label for="dryProtein">Dry Protein</label>
          <select id="dryProtein">
            <option value="chickpeas" selected>Chickpeas</option>
            <option value="soybeans">Soybeans</option>
            <option value="lentils">Lentils</option>
            <option value="blackbeans">Black Beans</option>
          </select>
        </div>
        <div>
          <label for="dryProteinAmount"><span id="dryProteinLabel">Chickpeas</span> <span
              class="muted">(grams)</span></label>
          <input id="dryProteinAmount" type="number" min="0" step="1" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="protein">Cooked Protein <span class="muted">(grams)</span></label>
          <input id="protein" type="number" min="0" step="1" />
        </div>
        <div>
          <label for="koji">Koji <span class="muted">(grams)</span></label>
          <input id="koji" type="number" min="0" step="1" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="percentage">Salt percentage</label>
          <select id="percentage">
            <option value="6">6%</option>
            <option value="7">7%</option>
            <option value="8">8%</option>
            <option value="9">9%</option>
            <option value="10" selected>10%</option>
            <option value="11">11%</option>
            <option value="12">12%</option>
          </select>
        </div>
        <div>
          <label for="units">Show salt as</label>
          <select id="units">
            <option value="g" selected>grams (g)</option>
            <option value="kg">kilograms (kg)</option>
          </select>
        </div>
      </div>

      <div class="result">
        <h2>Salt required</h2>
        <div class="big" id="saltOut">—</div>
        <div class="muted" id="percent"></div>
        <div class="note">Formula: <span class="formula">Salt = (Protein + Koji) × Percentage</span></div>
      </div>

    </div>
  </div>

  <script>
    const dryProteinEl = document.getElementById('dryProtein');
    const dryProteinAmountEl = document.getElementById('dryProteinAmount');
    const dryProteinLabelEl = document.getElementById('dryProteinLabel');
    const proteinEl = document.getElementById('protein');
    const kojiEl = document.getElementById('koji');
    const percentageEl = document.getElementById('percentage');
    const unitsEl = document.getElementById('units');
    const saltOut = document.getElementById('saltOut');
    const percent = document.getElementById('percent');

    // Protein multipliers for different dry protein types
    const proteinMultipliers = {
      'chickpeas': 2.20,
      'soybeans': 2.12,
      'lentils': 2.40,
      'blackbeans': 2.50
    };

    function calculateSalt(proteinGrams, kojiGrams, saltPercentage) {
      const totalIngredients = proteinGrams + kojiGrams;
      const saltRequired = totalIngredients * (saltPercentage / 100);
      return Math.max(0, saltRequired);
    }

    function calc() {
      const proteinG = Math.max(0, parseFloat(proteinEl.value || '0'));
      const kojiG = Math.max(0, parseFloat(kojiEl.value || '0'));
      const saltPct = parseFloat(percentageEl.value || '10');

      const saltG = calculateSalt(proteinG, kojiG, saltPct);
      const show = unitsEl.value;
      const saltDisplay = show === 'kg' ? saltG / 1000 : saltG;
      const unitLabel = show === 'kg' ? 'kg' : 'g';

      saltOut.textContent = saltDisplay.toFixed(show === 'kg' ? 3 : 0) + ' ' + unitLabel;
      percent.textContent = saltPct + '% of (protein + koji) = ' + saltPct + '% of ' + (proteinG + kojiG) + 'g';
    }

    function updateDryProteinLabel() {
      const selectedOption = dryProteinEl.options[dryProteinEl.selectedIndex];
      dryProteinLabelEl.textContent = selectedOption.text;
      calculateProteinFromDryWeight();
    }

    function calculateProteinFromDryWeight() {
      const dryWeight = parseFloat(dryProteinAmountEl.value || '0');
      const selectedProtein = dryProteinEl.value;
      const multiplier = proteinMultipliers[selectedProtein];

      if (dryWeight > 0 && multiplier) {
        const proteinAmount = Math.round(dryWeight * multiplier);
        proteinEl.value = proteinAmount;
        calc(); // Recalculate salt after updating protein
      } else if (dryWeight === 0) {
        proteinEl.value = '';
        calc();
      }
    }

    dryProteinEl.addEventListener('change', updateDryProteinLabel);
    dryProteinAmountEl.addEventListener('input', calculateProteinFromDryWeight);
    proteinEl.addEventListener('input', calc);
    kojiEl.addEventListener('input', calc);
    percentageEl.addEventListener('change', calc);
    unitsEl.addEventListener('change', calc);
    calc();
  </script>
</body>

</html>
